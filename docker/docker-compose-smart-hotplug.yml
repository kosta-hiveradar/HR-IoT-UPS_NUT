services:
  ups-nut-smart:
    image: kostahiveradar/ups-nut-2.8.4-arm64:smart
    container_name: ups-nut-smart
    restart: unless-stopped
    privileged: true
    platform: linux/arm64
    devices:
      - /dev/bus/usb:/dev/bus/usb
    ports:
      - "3493:3493"
    volumes:
      - ups-nut-state:/var/run/nut
      - ups-nut-logs:/var/log/nut
      - /run/udev:/run/udev:ro
    environment:
      - TZ=UTC
      - SCAN_INTERVAL=60
      - DEBUG=1
    healthcheck:
      test: ["CMD", "sh", "-c", "/opt/nut/bin/upsc -l > /dev/null 2>&1 || echo 'No UPS detected - waiting for hotplug'"]
      interval: 60s
      timeout: 15s
      retries: 3
      start_period: 60s

volumes:
  ups-nut-state:
  ups-nut-logs: